Below is a tutorial designed for your lecture, focusing exclusively on Python Poetry for Python programmers. It covers Poetry's core features, how to manage dependencies and projects, and best practices, without any Docker-related content. The tutorial is structured as a markdown document, tailored for Python developers, and includes practical examples starting with simple Python programs and progressing to a Flask web application.


# Python Poetry Tutorial for Programmers

This tutorial is designed for Python programmers who want to learn how to use Poetry, a dependency management and packaging tool for Python. We'll cover Poetry's core features, how to manage dependencies and projects, and best practices, starting with simple Python programs and moving to a Flask web application.

## 1. Introduction to Poetry

Poetry is a tool that simplifies dependency management, virtual environments, and packaging for Python projects. It provides a consistent way to define, install, and track dependencies, ensuring reproducible builds.

### Why Use Poetry?
- **Dependency Management**: Easily manage libraries with pinned versions in a `poetry.lock` file.
- **Virtual Environments**: Automatically create and manage isolated environments.
- **Project Packaging**: Build and publish Python packages to PyPI with minimal effort.
- **Simplified Workflow**: Replace `pip`, `virtualenv`, and `setup.py` with a single tool.

## 2. Installing Poetry

Install Poetry by following the official instructions at [python-poetry.org](https://python-poetry.org/docs/#installation). The recommended method is:

```bash
curl -sSL https://install.python-poetry.org | python3 -
```

Verify installation:
```bash
poetry --version
```

Add Poetry to your shell’s path if needed (instructions provided during installation).

## 3. Poetry Basics

- **pyproject.toml**: The configuration file for your project, defining metadata and dependencies.
- **poetry.lock**: A lock file that pins exact versions of dependencies for reproducibility.
- **Virtual Environment**: Poetry creates a virtual environment for each project, isolating dependencies.
- **Commands**: Poetry provides commands to manage dependencies, environments, and packaging.

### Key Commands
```bash
poetry init            # Initialize a new Poetry project
poetry add <package>   # Add a dependency
poetry install         # Install dependencies
poetry run <command>   # Run a command in the virtual environment
poetry shell           # Activate the virtual environment
```

## 4. Managing Simple Python Programs with Poetry

Let’s start with two simple Python programs to learn Poetry’s workflow.

### Example 1: Hello World Script

Create a directory `hello-python` and initialize a Poetry project:

```bash
mkdir hello-python
cd hello-python
poetry init --no-interaction --dependency python=^3.9
```

This creates a `pyproject.toml` file. Create the following file:

**hello.py**
```python
print("Hello, Poetry!")
```

**pyproject.toml** (generated by `poetry init`, simplified)
```toml
[tool.poetry]
name = "hello-python"
version = "0.1.0"
description = "A simple Python script"
authors = ["Your Name <you@example.com>"]

[tool.poetry.dependencies]
python = "^3.9"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
```

Run the script:
```bash
poetry run python hello.py
```

**Expected Output**:
```
Hello, Poetry!
```

Alternatively, activate the virtual environment:
```bash
poetry shell
python hello.py
```

Poetry creates a virtual environment automatically, isolating the project.

### Example 2: Simple Calculator Script

Create a directory `calc-python` and initialize a Poetry project:

```bash
mkdir calc-python
cd calc-python
poetry init --no-interaction --dependency python=^3.9
```

Create the following file:

**calculator.py**
```python
def add(a, b):
    return a + b

result = add(5, 3)
print(f"5 + 3 = {result}")
```

**pyproject.toml**
```toml
[tool.poetry]
name = "calc-python"
version = "0.1.0"
description = "A simple calculator script"
authors = ["Your Name <you@example.com>"]

[tool.poetry.dependencies]
python = "^3.9"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
```

Run the script:
```bash
poetry run python calculator.py
```

**Expected Output**:
```
5 + 3 = 8
```

These examples demonstrate how to set up and run simple Python scripts with Poetry.

## 5. Managing a Python Web Application with Poetry

Now, let’s use Poetry to manage a Flask web application with dependencies.

### Step 1: Create a Flask App
Create a directory `my-python-app` and initialize a Poetry project:

```bash
mkdir my-python-app
cd my-python-app
poetry init --no-interaction --dependency python=^3.9
```

Add Flask as a dependency:
```bash
poetry add flask==2.0.1
```

Create the following file:

**app.py**
```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return "Hello, Poetry-powered Flask App!"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```

**pyproject.toml** (updated by `poetry add`)
```toml
[tool.poetry]
name = "my-python-app"
version = "0.1.0"
description = "A Flask app with Poetry"
authors = ["Your Name <you@example.com>"]

[tool.poetry.dependencies]
python = "^3.9"
flask = "2.0.1"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
```

### Step 2: Install Dependencies and Run
Install dependencies:
```bash
poetry install
```

Run the Flask app:
```bash
poetry run python app.py
```

Visit `http://localhost:5000` in your browser to see the app running.

Alternatively, use the virtual environment:
```bash
poetry shell
python app.py
```

## 6. Best Practices for Poetry

### Pin Dependencies
- Poetry automatically generates a `poetry.lock` file to pin exact dependency versions. Commit this file to version control for reproducible builds.
- Update dependencies safely:
```bash
poetry update
```

### Separate Development Dependencies
Add development tools (e.g., pytest) separately:
```bash
poetry add --group dev pytest
```

This adds to `pyproject.toml`:
```toml
[tool.poetry.group.dev.dependencies]
pytest = "^7.0"
```

### Use Semantic Versioning
Specify version constraints in `pyproject.toml`:
```toml
flask = "^2.0.1"  # Allows updates to 2.x.x, but not 3.0.0
```

### Organize Projects
- Keep `pyproject.toml` clean and minimal.
- Use Poetry’s script shortcuts for common tasks:
```toml
[tool.poetry.scripts]
start = "python app.py"
```

Run with:
```bash
poetry run start
```

### Manage Virtual Environments
- Poetry stores virtual environments in `~/.cache/pypoetry/virtualenvs` by default. To store them in the project directory:
```bash
poetry config virtualenvs.in-project true
```

## 7. Publishing a Package with Poetry

Poetry makes it easy to package and publish Python libraries to PyPI.

### Example: Package the Calculator
Modify `calc-python` to be a publishable package.

Update `pyproject.toml`:
```toml
[tool.poetry]
name = "simple-calculator"
version = "0.1.0"
description = "A simple calculator library"
authors = ["Your Name <you@example.com>"]
license = "MIT"
readme = "README.md"

[tool.poetry.dependencies]
python = "^3.9"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
```

Create a module structure:

```bash
mkdir simple_calculator
touch simple_calculator/__init__.py
```

Move and rename `calculator.py` to `simple_calculator/calculator.py`:
```python
def add(a, b):
    return a + b
```

Create `README.md`:
```markdown
# Simple Calculator
A basic Python library for arithmetic operations.
```

Build the package:
```bash
poetry build
```

Publish to PyPI (requires an account and API token):
```bash
poetry publish --username __token__ --password <your-pypi-token>
```

## 8. Debugging and Troubleshooting

- **Dependency Conflicts**: Check `poetry.lock` and resolve conflicts with:
```bash
poetry install --sync
```
- **Virtual Environment Issues**: Delete and recreate the environment:
```bash
rm -rf $(poetry env info --path)
poetry install
```
- **View Dependencies**: Inspect installed packages:
```bash
poetry show
```

## 9. Exercise for Attendees

**Task**: Create a Python script that fetches data from an API and manages dependencies with Poetry.

1. Write a script using `requests` to fetch data from `https://jsonplaceholder.typicode.com/posts`.
2. Set up a Poetry project and add `requests` as a dependency.
3. Run the script and verify the output.

**Solution**:

Create a directory `fetch-data` and initialize Poetry:

```bash
mkdir fetch-data
cd fetch-data
poetry init --no-interaction --dependency python=^3.9
poetry add requests==2.26.0
```

**fetch_data.py**
```python
import requests

response = requests.get("https://jsonplaceholder.typicode.com/posts")
with open("output.json", "w") as f:
    f.write(response.text)
print("Data saved to output.json")
```

**pyproject.toml**
```toml
[tool.poetry]
name = "fetch-data"
version = "0.1.0"
description = "Fetch data from an API"
authors = ["Your Name <you@example.com>"]

[tool.poetry.dependencies]
python = "^3.9"
requests = "2.26.0"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
```

Run:
```bash
poetry install
poetry run python fetch_data.py
```

Verify `output.json` contains the API response.

## 10. Additional Resources
- [Poetry Documentation](https://python-poetry.org/docs/)
- [PyPI](https://pypi.org/)
- [Poetry Best Practices](https://python-poetry.org/docs/faq/)
- [Python Packaging Guide](https://packaging.python.org/)

